# \>> 与 \>>>

看下面这段代码：

~~~js
length = start > end ? 0 : ((end - start) >>> 0)
start >>>= 0
~~~

代码中出现了>>> 操作符，我们知道>>是移位操作符，那>>>又是什么鬼呢？而且 >>> 0又有什么意义呢？

- \>> 与\>>>有什么不一样

查了MDN，原来>>是有符号右移，>>>是无符号右移

**\>>有符号右移：该操作符会将第一个操作数向右移动指定位数。向右被移出的位被丢弃，拷贝最左侧的位以填充左侧。**

~~~js
-9 >> 2
11111111111111111111111111110111  // -9 -> 11111111111111111111111111111101   // -3
~~~

**\>>>无符号右移：该操作符会将第一个操作数向右移动指定位数。向右被移出的位被丢弃，最左侧用0填充。因为符号位变成了0，所以结果总是非负的。（即便右移0个比特位，结果也是非负的）**

~~~~js
9 >>> 2
00000000000000000000000000001001   // 9 ->  00000000000000000000000000000010 // 2
~~~~

根据文档说明，即使移动0位也可以将负数变为正数，甚至可以将一个小数变为整数，将未定一个的值转换为0，那到底移动0位有什么意义呢？

- 移动0位有什么意义

引用stackoverflow中的一个回答：

>  It doesn't just convert non-Numbers to Number, it converts them to Numbers that can be expressed as 32-bit unsigned ints. 

**原来移位操作符会在移位之前做两种转换：第一，将不是number类型的数据转换为number类型；第二，将number类型的数据转换为无符号32bit数据，也就是Uint32类型。这些与移位无关，移位0主要就是用了js内部特性做了两种转换。**

- `Uint32`类型是如何转换的

1 . 如果不能转换为`Number`，那就为`0`
2 . 如果为非整数，先转换为整数，参考公式`sign(n) ⋅ floor(abs(n))`

```js
function ToInteger(x) {
    x = Number(x);
    return x < 0 ? Math.ceil(x) : Math.floor(x);
}
```

3 . 如果是正数，返回正数，如果是负数，返回负数 + 2的32次方

```js
function modulo(a, b) {
    return a - Math.floor(a/b)*b;
}
function ToUint32(x) {
    return modulo(ToInteger(x), Math.pow(2, 32));
}
```

- 总结

  x >>> 0本质上就是保证x有意义（为数字类型），且为正整数，在有效范围内（0~0xFFFFFFFF）（0~2**32-1），且在无意义情况下缺省值为0。







